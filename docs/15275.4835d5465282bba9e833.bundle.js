(self.webpackChunkKuiClientTemplate=self.webpackChunkKuiClientTemplate||[]).push([[15275,61937],{43212:(e,t,n)=>{"use strict";n.r(t),n.d(t,{createWindow:()=>P,initHeadless:()=>_,main:()=>C});var o=n(11227),i=n.n(o),r=n(8634),s=n(91201),l=n(26470),c=n(17737);const a=i()("main/localStorage");a("loading"),a("modules loaded");const d=()=>{a("init");const e=(0,l.join)((0,c.CF)(),"kui-local-storage.json");let t;a("userData %s",e);try{const n=(0,s.readFileSync)(e).toString();try{t=JSON.parse(n)}catch(e){throw a("error parsing userData",n),e}}catch(e){if("ENOENT"!==e.code)throw a("error reading userData"),e;t={}}a("parsed userData");const n=()=>{try{a("flush"),(0,s.writeFileSync)(e,JSON.stringify(t)),a("flush done")}catch(e){"ENOENT"===e.code?a("we decided not to initialize the store, but a plugin is trying to write to it"):console.error(e)}},o={getItem:e=>t[e]||null,setItem:(e,o)=>(a("setItem",e,o),t[e]=o,n(),o),removeItem:e=>{const o=t[e];return delete t[e],n(),o}};return a("init done"),o};var u=n(61284);const g=i()("core/util/mimic-dom");g("loading");var m=n(41833),p=n(88183),h=n(76036),v=n(186),f=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function l(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,l)}c((o=o.apply(e,t||[])).next())}))};const y=i()("main/headless");y("loading"),(0,h.setMedia)(h.Media.Headless);let w=0;v.on("uncaughtException",(e=>{console.error("Uncaught Exception",e)})),v.on("exit",(e=>{y("exiting",e)}));const b=/--command-context/;let E;const k=console.log,O=console.error;y("modules loaded");let x=!1;const S=(e,t)=>o=>f(void 0,void 0,void 0,(function*(){if(t&&t.rethrowErrors)throw o;const i=o.code||o.statusCode;y("failure",i,o);let r=Promise.resolve();if(v.env.TEST_CODE_ONLY&&o.statusCode)O(o.statusCode);else{let e;if(p.ZP.isUsageError(o))e=p.ZP.getFormattedMessage(o);else{const{oopsMessage:t}=yield Promise.resolve().then(n.bind(n,49170));e=t(o)}if("string"==typeof e){const t=yield Promise.resolve().then(n.t.bind(n,42138,23));v.env.TEST_INCLUDE_CODE&&o.statusCode?O(t.blue(o.statusCode.toString())+" "+t.red(e)):O(t.red(e))}else{const{print:t}=yield n.e(50647).then(n.bind(n,50647));r=t(e,O,v.stderr,void 0,"error")||Promise.resolve()}}return r.then((()=>(x||(w="number"==typeof i?i:1,v.env.KUI_REPL_MODE||(v.exit(w>128?w-256:w),e&&e())),!1)))}));let D;const P=(e,t,o,i)=>f(void 0,void 0,void 0,(function*(){try{x=!0;const{setGraphicalShellIsOpen:r}=yield n.e(50647).then(n.bind(n,50647));if(!r(i))return void y("probably a bug somewhere; detected loop in opening window from headless mode");const s=e;E&&s.push(E),D(s,t,o)}catch(e){O(e)}}));const C=(e,t,o=v.argv,i)=>f(void 0,void 0,void 0,(function*(){y("main");const s=(0,m.init)(),l=yield function(){return f(this,void 0,void 0,(function*(){const{init:e}=yield Promise.resolve().then(n.bind(n,38387));yield e()}))}(),c=o.find((e=>b.test(e)));y("commandContext",c),!E&&c&&(E=c);const a=o.indexOf("--"),p=a>=0?a+1:1,h=o.slice(p).filter((e=>!b.test(e)&&"--kui-headless"!==e&&"--raw-output"!==e&&"--no-color"!==e&&"--no-colors"!==e&&"--color=always"!==e&&"--ui"!==e));y("argv",h);const{quit:O}=e;D=t.createWindow,function(){g("mimicDom"),n.g.window={navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:74.0) Gecko/20100101 Firefox/74.0"}};try{n.g.localStorage=d(),n.g.sessionStorage=d(),g("successfully initialized persistent localStorage")}catch(e){g("error initializing persistent localStorage",e);const t={},o={};n.g.localStorage={setItem:(e,n)=>(t[e]=n,n),getItem:e=>t[e]||null},n.g.sessionStorage={setItem:(e,t)=>(o[e]=t,t),getItem:e=>o[e]||null}}finally{n.g.window.localStorage=localStorage,n.g.window.sessionStorage=sessionStorage}window.addEventListener=()=>!0;const e=()=>new u.Z;n.g.document={body:e(),getElementById:t=>e(),createElement:t=>{const n=e();return n.nodeType=t,"table"===t&&(n.rows=[]),n},addEventListener:()=>!0,createTextNode:t=>{const n=e();return n.innerText=t,n},querySelector:t=>e()},g("mimicDom done")}();const P=Object.assign({rethrowErrors:!0},i),C=e=>Promise.resolve((0,r.exec)(e,P)).then((e=>t=>f(void 0,void 0,void 0,(function*(){if(y("success!"),v.env.KUI_REPL_MODE)return y("returning repl mode result"),t;const{print:o}=yield n.e(50647).then(n.bind(n,50647));yield o(t,k,v.stdout),x?y("graphical shell is open"):(e(),v.exit(w))})))(O));return y("bootstrap"),Promise.all([s,l]).then((([e])=>f(void 0,void 0,void 0,(function*(){y("plugins initialized"),e&&(yield(e=>f(void 0,void 0,void 0,(function*(){if(e)try{y("setting command context",e),(yield Promise.resolve().then(n.bind(n,94052))).setDefaultCommandContext(JSON.parse(e.substring(e.indexOf("=")+1)))}catch(e){y("Error initializing command context",e)}})))(E));const t=e=>S(O,i)(e);if(e&&(y("invoking plugin preloader"),yield(0,m.preload)(),y("invoking plugin preloader... done")),(e=>0===e.length||1===e.length&&/(-h)|(--help)/.test(e[0]))(h))return y("insufficient args, invoking help command"),C("help");const o=h.map((e=>e.match(/\s+/)?`"${e}"`:e)).join(" ").trim();if(o&&o.length>0)return y("about to execute command",o),C(o).catch(t);y("exiting, no command"),v.env.KUI_REPL_MODE||v.exit(0)})))).catch(S(O,i))}));function _(e,t=!1,o=!1,i){if(t||o){y("initHeadless");const t={quit:()=>v.exit(0)};try{return C(t,{createWindow:(e,t,o)=>f(this,void 0,void 0,(function*(){const{createWindow:i}=yield Promise.all([n.e(8575),n.e(74381),n.e(24992)]).then(n.bind(n,74381));return i(!0,e,t,o,!1,!0)}))},e,i)}catch(e){if(console.error("Internal Error, please report this bug:"),console.error(e),v.env.KUI_REPL_MODE)throw e;v.exit(1)}}}},67329:e=>{function t(e){return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}t.keys=()=>[],t.resolve=t,t.id=67329,e.exports=t},80534:(e,t,n)=>{var o={"./plugin-bash-like/fs/mdist/plugin":[10987,10987],"./plugin-bash-like/mdist/plugin":[30890,8575,79267,29224,79083],"./plugin-client-common/mdist/plugin":[18890,18890],"./plugin-core-support/about/mdist/plugin":[33244,33244],"./plugin-core-support/mdist/plugin":[23814,23814],"./plugin-core-support/up/mdist/plugin":[66136,8575,79267,29224,66136,56621],"./plugin-kubectl/helm/mdist/plugin":[86208,58853,54527],"./plugin-kubectl/krew/mdist/plugin":[83836,58853,72032],"./plugin-kubectl/logs/mdist/plugin":[94640,58853,8942],"./plugin-kubectl/mdist/plugin":[60502,58853,39048],"./plugin-kubectl/oc/mdist/plugin":[58719,58853,53245],"./plugin-kubectl/odo/mdist/plugin":[65148,58853,38840],"./plugin-kubectl/view-utilization/mdist/plugin":[72195,58853,72828]};function i(e){if(!n.o(o,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=o[e],i=t[0];return Promise.all(t.slice(1).map(n.e)).then((()=>n(i)))}i.keys=()=>Object.keys(o),i.id=80534,e.exports=i},8176:(e,t,n)=>{var o={"./plugin-bash-like/fs/mdist/preload":[7191,7191],"./plugin-bash-like/mdist/preload":[54047,54047],"./plugin-core-support/mdist/preload":[13412,13412],"./plugin-kubectl/helm/mdist/preload":[11778,11778],"./plugin-kubectl/mdist/preload":[71055,71055]};function i(e){if(!n.o(o,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=o[e],i=t[0];return n.e(t[1]).then((()=>n(i)))}i.keys=()=>Object.keys(o),i.id=8176,e.exports=i},91201:()=>{}}]);