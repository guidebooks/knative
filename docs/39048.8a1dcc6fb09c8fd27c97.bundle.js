(self.webpackChunkKuiClientTemplate=self.webpackChunkKuiClientTemplate||[]).push([[39048],{68215:(t,e,n)=>{"use strict";function o(t){return"IP"===t?t:t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}function i(t){return t.body.reduce(((t,e)=>(t[o(e.key)]=e.name,e.attributes.forEach((({key:e,value:n})=>{t[o(e)]=n})),t)),{})}n.d(e,{k:()=>o,Z:()=>i})},60502:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>it});var o=n(91119),i=n(72890),r=n(94194),a=n(98919),c=n(36156),s=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))};const u=t=>e=>s(void 0,void 0,void 0,(function*(){if((0,c.lN)(e))return(0,c.t$)(t,e);{const n=yield(0,r.GL)(e,void 0,t),{content:{stderr:i,stdout:c}}=n;if((0,o.isXtermResponse)(c))return c;const s=yield(0,a.rW)(c,i,e,t,"explain","api-resources");return(0,o.isTable)(s)&&(s.body.forEach((e=>{const n=e.attributes[3]&&e.attributes[3].value||e.name;e.onclick=`${t} explain ${n}`})),s.body.sort(((t,e)=>t.name.localeCompare(e.name)))),s}}));var l=n(347),f=n(67039),d=n(68215);function p(t,e){return o.Util.flatten([t,`${t}s`].concat(e?[e]:[]).map((t=>[t,(0,d.k)(t)])))}var m=n(28724),v=n(84323),h=n(50816),y=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))};function b(t){return y(this,void 0,void 0,(function*(){const e=yield(0,m.gc)((0,h.fY)(t))(t);if((0,o.isTable)(e)&&e.header){(0,a.ei)("up-to-date",e);const t=e.header.attributes.findIndex((t=>/Ready/i.test(t.key)));t>=0&&((0,a.ov)(t,e),e.statusColumnIdx=t,e.body.forEach((e=>{const n=e.attributes[t];if(n&&n.value){const t=n.value.match(/(\d+)\/(\d+)/);if(t&&3===t.length){n.tag="badge";const e=parseInt(t[1],10),o=parseInt(t[2],10);n.css=e===o?v.Z.Green:0===e?v.Z.Red:v.Z.Yellow}}})))}return e}))}const k=t=>{var e,n,i,r;(e="deployment",n="deploy",i="v1",r="apps",i?o.Util.flatten(p(e,n).map((t=>[t,`${t}.${r}`,`${t}.${i}.${r}`]))):p(e,n)).forEach((e=>{["k","kubectl","oc"].forEach((n=>{t.listen(`/${n}/get/${e}`,b,m.L6)}))}))};var w=n(76600),x=n(26470),g=n(58853),$=n(25218),O=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))};const P=(0,o.i18n)("plugin-kubectl"),E=t=>function(e){return O(this,void 0,void 0,(function*(){if((0,c.lN)(e))return(0,c.t$)(t,e);try{const{REPL:n}=e,i=(0,g.$L)(e);if("string"!=typeof i)throw new Error("multi-file diff currently unsupported");const r=o.Util.absolute(o.Util.expandHomeDir(i)),a=(0,x.basename)(i),c=(0,x.dirname)(i),s="."===c?void 0:c,[u,l]=yield Promise.all([n.qexec((0,g.QG)(e,`${t} get ${(0,g.W2)(e)} -o yaml`)),n.qexec((0,g.QG)(e,`${t} apply ${(0,g.W2)(e)} --dry-run=server -o yaml`))]);if(console.error("previous",u),console.error("current",l),(0,$.Ib)(u)&&(0,$.Ib)(l)){const t={mode:"diff",label:P("Pending Changes"),content:{a:(0,h.p2)(u.kuiRawData),b:(0,h.p2)(l.kuiRawData)},contentType:"yaml"};return{apiVersion:"kui-shell/v1",kind:"File",metadata:{name:a,namespace:s},toolbarText:{type:"info",text:P("Showing changes between the working tree and previous commit.")},modes:[t],spec:{filepath:i,fullpath:r,size:0}}}throw new Error("failed to get resources")}catch(n){return console.error("error at kubectl diff",n),(0,r.GL)(e,void 0,t)}}))};function Z(t,e,n=e){t.listen(`/${e}/diff`,E(n))}var N=n(70764),T=n(42177),L=n(66167),R=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))};function z({tab:t}){return R(this,void 0,void 0,(function*(){return(yield(0,l.getCurrentContext)(t)).metadata.namespace}))}var C=n(88363),I=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))};const G=(0,o.i18n)("plugin-kubectl","kustomize");function j(t){const e=t.argvNoOptions.indexOf("kustomize"),n=t.argvNoOptions[e+1];return n?t.command.replace(new RegExp(n,"g"),o.Util.expandHomeDir(n)):t.command}function A(t,e){const n=e.split(/---/),o=t.reduce(((t,e,o)=>{const i=(0,C.H1)(e);return t[i]||(t[i]={label:i,items:[]}),t[i].items.push({mode:e.metadata.name,content:n[o].replace(/^\n/,""),contentType:"yaml"}),t}),{}),i={label:G("Raw Data"),items:[{mode:"YAML",content:e,contentType:"yaml"}]};return Object.values(o).concat([i])}const U=(t="kubectl")=>e=>I(void 0,void 0,void 0,(function*(){if((0,c.lN)(e))return(0,c.t$)(t,e);{const[o,{loadAll:i}]=yield Promise.all([(0,r.d1)(e,j,t),n.e(1272).then(n.bind(n,1272))]);try{const t=i(o),n=(0,x.resolve)(e.argvNoOptions[e.argvNoOptions.indexOf("kustomize")+1]);return{apiVersion:"kui-shell/v1",kind:"NavResponse",breadcrumbs:[{label:"kustomize"},{label:(0,x.basename)(n),command:`open ${n}`}],menus:A(t,o)}}catch(t){return console.error("error preparing kustomize response",t),o}}}));var B=n(72400),S=n(83923),q=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))};const D="top",_=t=>function(e){return q(this,void 0,void 0,(function*(){if((0,c.lN)(e))return(0,c.t$)(t,e);{const n=yield(0,r.GL)(e);return(0,m.Bm)(t,e,n,D)}}))};var F=n(87500),Q=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))};function H(t){["kubectl","k"].forEach((e=>{const n=(0,m.gc)(e);var i,r,a;(i="job",r="v1",a="batch",o.Util.flatten(o.Util.flatten([i,`${i}s`].map((t=>[t,(0,d.k)(t)]))).map((t=>[t,`${t}.${a}`,`${t}.${r}.${a}`])))).forEach((i=>{t.listen(`/${e}/get/${i}`,(t=>Q(this,void 0,void 0,(function*(){if((0,g.QI)(t))return n(t);const e=t.argvNoOptions.slice(t.argvNoOptions.indexOf(i)+1),r=0===e.length?"job-name":`'job-name in (${e.join(",")})'`,a=(0,g.QG)(t,`kubectl get pod -l ${r} --sort-by={.status.startTime} -o custom-columns=JOB:.metadata.ownerReferences[0].name,NAME:.metadata.name,STATUS:.status.phase,START:.status.startTime,START2:.status.containerStatuses[0].state.terminated.startedAt,END:.status.containerStatuses[0].state.terminated.finishedAt ${(0,g.nf)(t)} ${t.parsedOptions.limit?`--limit ${t.parsedOptions.limit}`:"--limit 200"}`),c=yield t.REPL.qexec(a,void 0,void 0,t.execOptions);return(0,o.isTable)(c)?(c.title="Job",c):c}))),m.L6)}))}))}var K=n(82216),W=n(11227),Y=n.n(W),J=n(76299),M=n(48764).Buffer,V=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))};const X=Y()("plugin-kubectl/controller/fetch-file");function tt(t){return V(this,void 0,void 0,(function*(){const{lstat:e}=yield n.e(27935).then(n.t.bind(n,27935,23));return new Promise(((n,o)=>{e(t,((t,e)=>{t?"ENOENT"===t.code?n(!1):o(t):n(e.isFile())}))}))}))}function et(t,e){return V(this,void 0,void 0,(function*(){const[o,{join:i}]=yield Promise.all([tt(e),Promise.resolve().then(n.t.bind(n,26470,23))]);if(o)return{data:yield(0,J.LG)(t,e)[0]};{const n=i(e,"kustomization.yml"),o=i(e,"kustomization.yaml"),r=i(e,"Kustomization"),[a,c,s]=yield Promise.all([tt(n),tt(o),tt(r)]),u=e;if(a)return{data:(yield(0,J.LG)(t,n))[0]||"",dir:u};if(c)return{data:(yield(0,J.LG)(t,o))[0]||"",dir:u};if(s)return{data:(yield(0,J.LG)(t,r))[0]||"",dir:u}}}))}function nt(t){return V(this,void 0,void 0,(function*(){const{argvNoOptions:e,parsedOptions:n,execOptions:o}=t,i=e[e.indexOf("_fetchfile")+1],r=Object.assign({tryFetchEvenInBrowser:!0},"object"!=typeof o.data||M.isBuffer(o.data)?void 0:o.data);return n.kustomize?{mode:"raw",content:yield et(t,i)}:{mode:"raw",content:yield(0,J.dc)(t,i,r)}}))}var ot=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))};const it=t=>ot(void 0,void 0,void 0,(function*(){(t=>{t.listen("/kubectl/api-resources",u("kubectl"),i.Z),t.listen("/k/api-resources",u("kubectl"),i.Z)})(t),(0,l.default)(t),(0,f.ZP)(t),(0,w.Z)(t),(t=>{Z(t,"kubectl"),Z(t,"k","kubectl")})(t),(0,T.ZP)(t),(0,N.ZP)(t),(0,L.Z)(t),H(t),(0,m.ZP)(t),t.listen("/namespace/current",z,m.L6),k(t),(t=>{t.listen("/kubectl/kustomize",U(),i.Z),t.listen("/k/kustomize",U(),i.Z)})(t),(0,B.ZP)(t),(0,S.Z)(t),(t=>{t.listen("/kubectl/top/node",_("kubectl"),i.Z),t.listen("/k/top/node",_("k"),i.Z),t.listen("/kubectl/top/pod",_("kubectl"),i.Z),t.listen("/k/top/pod",_("k"),i.Z)})(t),(0,F.ZP)(t),(0,K.ZP)(t),(t=>{t.listen("/_openstream",(t=>V(void 0,void 0,void 0,(function*(){const e=t.argvNoOptions[t.argvNoOptions.indexOf("_openstream")+1],n="object"!=typeof t.execOptions.data||M.isBuffer(t.execOptions.data)?void 0:t.execOptions.data.headers;if(X("openstream",e),!t.execOptions.onInit)throw new Error("Internal Error: onInit required");return new Promise(((o,i)=>V(void 0,void 0,void 0,(function*(){try{yield(0,J.Cg)(t,e,{onInit:t.execOptions.onInit,onReady:t.execOptions.onReady,onExit:e=>{X("got exit from stream",e),t.execOptions.onExit&&t.execOptions.onExit(e),o(!0)}},n)}catch(t){i(t)}}))))}))),{requiresLocal:!0}),t.listen("/_fetchfile",nt,{requiresLocal:!0,flags:{boolean:["kustomize"]}}),t.listen("/vfs/_fetchfile",nt,{flags:{boolean:["kustomize"]}})})(t),(t=>{o.Capabilities.inBrowser()&&!o.Capabilities.hasProxy()||t.catchall((t=>{return e=t[0],/^k(ubectl)?$/.test(e);var e}),(t=>(0,c.lN)(t)?(0,c.t$)("kubectl",t):(0,r.fF)(t)),1)})(t)}))},47689:()=>{}}]);